<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TaskLoop - AI ä»»åŠ¡é—­ç¯ç®¡ç†ç³»ç»Ÿ</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Noto Sans SC', -apple-system, sans-serif; -webkit-font-smoothing: antialiased; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    .animate-fadeIn { animation: fadeIn 0.3s ease; }
    .animate-slideIn { animation: slideIn 0.3s ease; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #D1D5DB; border-radius: 3px; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // ==================== SVG å›¾æ ‡ ====================
    const Icons = {
      Home: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
      ClipboardList: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>,
      Bell: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>,
      Settings: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
      Plus: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
      Search: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
      Calendar: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>,
      User: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
      Users: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      MoreHorizontal: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>,
      Check: () => <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6 9 17l-5-5"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
      ChevronLeft: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
      ChevronRight: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
      TrendingUp: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
      TrendingDown: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></svg>,
      Clock: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      AlertTriangle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>,
      Circle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/></svg>,
      Edit3: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>,
      RefreshCw: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
      Filter: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
      ArrowUpRight: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 7h10v10"/><path d="M7 17 17 7"/></svg>,
      Sparkles: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>,
      LogOut: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>,
      Target: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Flag: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>,
    };

    // ==================== è®¾è®¡ç³»ç»Ÿ ====================
    const priorityColors = {
      P1: { bg: '#FEE2E2', text: '#DC2626', dot: '#DC2626' },
      P2: { bg: '#FEF3C7', text: '#D97706', dot: '#F59E0B' },
      P3: { bg: '#F3F4F6', text: '#6B7280', dot: '#9CA3AF' },
    };

    const statusConfig = {
      NOT_STARTED: { label: 'æœªå¼€å§‹', bg: '#F3F4F6', text: '#6B7280' },
      IN_PROGRESS: { label: 'è¿›è¡Œä¸­', bg: '#DBEAFE', text: '#2563EB' },
      PENDING_REVIEW: { label: 'å¾…éªŒæ”¶', bg: '#FEF3C7', text: '#D97706' },
      COMPLETED: { label: 'å·²å®Œæˆ', bg: '#D1FAE5', text: '#059669' },
      BLOCKED: { label: 'å·²é˜»å¡', bg: '#FEE2E2', text: '#DC2626' },
    };

    // ==================== æ¨¡æ‹Ÿæ•°æ® ====================
    const mockUser = { id: '1', name: 'ä»˜å‡Œä¼Ÿ', role: 'DIRECTOR', department: 'äººåŠ›èµ„æºéƒ¨' };

    const mockTasks = [
      { id: '1', title: 'å®Œæˆäº§çº¿ A è‡ªåŠ¨åŒ–æ”¹é€ æ–¹æ¡ˆ', priority: 'P1', status: 'IN_PROGRESS', progress: 60, dueDate: '2026-02-05', owner: { name: 'å¼ ä¸‰' }, collaborators: [{ name: 'æå››' }], acceptanceCriteria: '1. å®Œæˆæ–¹æ¡ˆæ–‡æ¡£\n2. é€šè¿‡æŠ€æœ¯è¯„å®¡\n3. è·å¾—é¢„ç®—æ‰¹å‡†', updates: [{ date: '2026-02-01', content: 'å®Œæˆåˆç¨¿ï¼Œå‡†å¤‡è¯„å®¡', progress: 60 }] },
      { id: '2', title: 'æ–°èƒ½æºç”µæ± æµ‹è¯•è®¾å¤‡é€‰å‹è¯„ä¼°', priority: 'P2', status: 'NOT_STARTED', progress: 0, dueDate: '2026-02-10', owner: { name: 'æå››' }, collaborators: [], acceptanceCriteria: 'å®Œæˆ3å®¶ä¾›åº”å•†å¯¹æ¯”æŠ¥å‘Š', updates: [] },
      { id: '3', title: '3Cäº§å“æ£€æµ‹æµç¨‹ä¼˜åŒ–', priority: 'P1', status: 'PENDING_REVIEW', progress: 90, dueDate: '2026-02-03', owner: { name: 'ç‹äº”' }, collaborators: [{ name: 'å¼ ä¸‰' }], acceptanceCriteria: 'æ£€æµ‹æ—¶é—´ç¼©çŸ­20%', updates: [{ date: '2026-02-01', content: 'å·²å®Œæˆä¼˜åŒ–ï¼Œç­‰å¾…éªŒæ”¶', progress: 90 }] },
      { id: '4', title: 'ä¾›åº”å•†å¹´åº¦è¯„å®¡æŠ¥å‘Š', priority: 'P2', status: 'BLOCKED', progress: 30, dueDate: '2026-02-08', owner: { name: 'å¼ ä¸‰' }, collaborators: [], acceptanceCriteria: 'å®Œæˆæ‰€æœ‰ä¾›åº”å•†è¯„åˆ†', updates: [{ date: '2026-01-30', content: 'ç­‰å¾…è´¢åŠ¡æ•°æ®', progress: 30 }] },
      { id: '5', title: 'è®¾å¤‡ç»´æŠ¤è®¡åˆ’Q1æ‰§è¡Œ', priority: 'P3', status: 'COMPLETED', progress: 100, dueDate: '2026-01-31', owner: { name: 'æå››' }, collaborators: [], acceptanceCriteria: 'å®Œæˆå­£åº¦ç»´æŠ¤æ£€æŸ¥', updates: [] },
      { id: '6', title: 'åŒ»ç–—è®¾å¤‡åˆè§„è®¤è¯ææ–™å‡†å¤‡', priority: 'P1', status: 'IN_PROGRESS', progress: 45, dueDate: '2026-02-15', owner: { name: 'ç‹äº”' }, collaborators: [{ name: 'å¼ ä¸‰' }, { name: 'æå››' }], acceptanceCriteria: 'å®ŒæˆISO13485æ–‡æ¡£', updates: [] },
    ];

    const mockNotifications = [
      { id: '1', type: 'TASK_ASSIGNED', title: 'æ–°ä»»åŠ¡åˆ†é…', content: 'æ‚¨è¢«åˆ†é…äº†æ–°ä»»åŠ¡ï¼šåŒ»ç–—è®¾å¤‡åˆè§„è®¤è¯ææ–™å‡†å¤‡', time: '10åˆ†é’Ÿå‰', read: false },
      { id: '2', type: 'TASK_DUE_SOON', title: 'ä»»åŠ¡å³å°†åˆ°æœŸ', content: 'ä»»åŠ¡"å®Œæˆäº§çº¿ A è‡ªåŠ¨åŒ–æ”¹é€ æ–¹æ¡ˆ"å°†äº2å¤©ååˆ°æœŸ', time: '1å°æ—¶å‰', read: false },
      { id: '3', type: 'TASK_OVERDUE', title: 'ä»»åŠ¡å·²é€¾æœŸ', content: 'ä»»åŠ¡"3Cäº§å“æ£€æµ‹æµç¨‹ä¼˜åŒ–"å·²é€¾æœŸ1å¤©', time: '3å°æ—¶å‰', read: true },
    ];

    // ==================== å·¥å…·å‡½æ•° ====================
    const formatDate = (date) => {
      const d = new Date(date);
      return `${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥`;
    };
    const getDaysUntilDue = (dueDate) => Math.ceil((new Date(dueDate) - new Date()) / (1000 * 60 * 60 * 24));

    // ==================== åŸºç¡€ç»„ä»¶ ====================
    const Avatar = ({ name, size = 40 }) => (
      <div style={{ width: size, height: size, borderRadius: '50%', background: 'linear-gradient(135deg, #6366F1, #4F46E5)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontWeight: 600, fontSize: size * 0.4, flexShrink: 0 }}>
        {name?.charAt(0) || '?'}
      </div>
    );

    const Button = ({ children, variant = 'primary', size = 'md', icon, fullWidth, onClick, style = {} }) => {
      const variants = {
        primary: { background: 'linear-gradient(135deg, #6366F1, #4F46E5)', color: 'white', boxShadow: '0 4px 14px rgba(99, 102, 241, 0.35)' },
        secondary: { background: 'white', color: '#374151', border: '1px solid #D1D5DB' },
        ghost: { background: 'transparent', color: '#6B7280' },
      };
      const sizes = { sm: { height: 32, padding: '0 12px', fontSize: 13 }, md: { height: 40, padding: '0 16px', fontSize: 14 }, lg: { height: 48, padding: '0 24px', fontSize: 15 } };
      
      return (
        <button onClick={onClick} style={{ ...variants[variant], ...sizes[size], width: fullWidth ? '100%' : 'auto', borderRadius: 12, fontWeight: 600, display: 'inline-flex', alignItems: 'center', justifyContent: 'center', gap: 8, cursor: 'pointer', border: variants[variant].border || 'none', transition: 'all 0.15s', ...style }}>
          {icon}{children}
        </button>
      );
    };

    const Input = ({ placeholder, value, onChange, icon, style = {} }) => (
      <div style={{ position: 'relative', ...style }}>
        {icon && <div style={{ position: 'absolute', left: 14, top: '50%', transform: 'translateY(-50%)', color: '#9CA3AF' }}>{icon}</div>}
        <input type="text" placeholder={placeholder} value={value} onChange={onChange}
          style={{ width: '100%', height: 40, padding: icon ? '0 14px 0 42px' : '0 14px', background: 'white', border: '1px solid #D1D5DB', borderRadius: 12, fontSize: 14, outline: 'none' }} />
      </div>
    );

    const StatusBadge = ({ status }) => {
      const c = statusConfig[status];
      return <span style={{ display: 'inline-flex', padding: '4px 10px', background: c.bg, color: c.text, fontSize: 12, fontWeight: 600, borderRadius: 20 }}>{c.label}</span>;
    };

    const PriorityTag = ({ priority }) => {
      const c = priorityColors[priority];
      return <span style={{ display: 'inline-flex', padding: '3px 8px', background: c.bg, color: c.text, fontSize: 11, fontWeight: 700, borderRadius: 6 }}>{priority}</span>;
    };

    const ProgressRing = ({ progress, size = 40 }) => {
      const r = (size - 4) / 2, c = r * 2 * Math.PI, offset = c - (progress / 100) * c;
      return (
        <div style={{ position: 'relative', width: size, height: size }}>
          <svg width={size} height={size} style={{ transform: 'rotate(-90deg)' }}>
            <circle cx={size/2} cy={size/2} r={r} fill="none" stroke="#E5E7EB" strokeWidth="3" />
            <circle cx={size/2} cy={size/2} r={r} fill="none" stroke="#6366F1" strokeWidth="3" strokeLinecap="round" strokeDasharray={c} strokeDashoffset={offset} style={{ transition: 'stroke-dashoffset 0.5s' }} />
          </svg>
          <span style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 10, fontWeight: 700, color: '#374151' }}>{progress}%</span>
        </div>
      );
    };

    // ==================== ç»Ÿè®¡å¡ç‰‡ ====================
    const StatCard = ({ title, value, change, trend, Icon, color = 'primary', onClick }) => {
      const colorMap = {
        primary: { icon: '#EEF2FF', iconText: '#6366F1', decoration: '#6366F1' },
        success: { icon: '#D1FAE5', iconText: '#10B981', decoration: '#10B981' },
        warning: { icon: '#FEF3C7', iconText: '#F59E0B', decoration: '#F59E0B' },
        danger: { icon: '#FEE2E2', iconText: '#EF4444', decoration: '#EF4444' },
      };
      const c = colorMap[color];

      return (
        <div onClick={onClick} style={{ position: 'relative', padding: '20px 24px', background: 'white', borderRadius: 16, border: '1px solid #E5E7EB', overflow: 'hidden', cursor: onClick ? 'pointer' : 'default', transition: 'all 0.2s' }}
          onMouseEnter={e => { e.currentTarget.style.transform = 'translateY(-2px)'; e.currentTarget.style.boxShadow = '0 20px 40px rgba(0,0,0,0.08)'; }}
          onMouseLeave={e => { e.currentTarget.style.transform = 'translateY(0)'; e.currentTarget.style.boxShadow = 'none'; }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 16 }}>
            <span style={{ fontSize: 14, color: '#6B7280', fontWeight: 500 }}>{title}</span>
            <div style={{ width: 40, height: 40, borderRadius: 10, background: c.icon, color: c.iconText, display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Icon /></div>
          </div>
          <div style={{ display: 'flex', alignItems: 'flex-end', gap: 12 }}>
            <span style={{ fontSize: 36, fontWeight: 700, color: '#111827', fontFamily: "'Plus Jakarta Sans', sans-serif", lineHeight: 1 }}>{value}</span>
            {change && (
              <div style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 13, fontWeight: 600, marginBottom: 4, color: trend === 'up' ? '#10B981' : '#EF4444' }}>
                {trend === 'up' ? <Icons.TrendingUp /> : <Icons.TrendingDown />}<span>{change}</span>
              </div>
            )}
          </div>
          <div style={{ position: 'absolute', right: -20, bottom: -20, width: 100, height: 100, borderRadius: '50%', background: c.decoration, opacity: 0.05 }} />
        </div>
      );
    };

    // ==================== ä»»åŠ¡å¡ç‰‡ ====================
    const TaskCard = ({ task, onClick }) => {
      const days = getDaysUntilDue(task.dueDate);
      const isOverdue = days < 0, isDueSoon = days >= 0 && days <= 2;
      
      return (
        <div onClick={onClick} style={{ background: 'white', borderRadius: 16, border: '1px solid #E5E7EB', padding: '16px 20px', cursor: 'pointer', transition: 'all 0.2s' }}
          onMouseEnter={e => { e.currentTarget.style.transform = 'translateY(-2px)'; e.currentTarget.style.boxShadow = '0 12px 24px rgba(0,0,0,0.06)'; e.currentTarget.style.borderColor = '#D1D5DB'; }}
          onMouseLeave={e => { e.currentTarget.style.transform = 'translateY(0)'; e.currentTarget.style.boxShadow = 'none'; e.currentTarget.style.borderColor = '#E5E7EB'; }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
            <div style={{ width: 4, height: 40, borderRadius: 2, background: priorityColors[task.priority].dot }} />
            <div style={{ width: 22, height: 22, borderRadius: 6, border: task.status === 'COMPLETED' ? '2px solid #10B981' : '2px solid #D1D5DB', background: task.status === 'COMPLETED' ? '#10B981' : 'transparent', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
              {task.status === 'COMPLETED' && <Icons.Check />}
            </div>
            <div style={{ flex: 1, minWidth: 0 }}>
              <h3 style={{ fontSize: 15, fontWeight: 600, color: '#111827', marginBottom: 8, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap', textDecoration: task.status === 'COMPLETED' ? 'line-through' : 'none', opacity: task.status === 'COMPLETED' ? 0.6 : 1 }}>{task.title}</h3>
              <div style={{ display: 'flex', alignItems: 'center', gap: 16, flexWrap: 'wrap' }}>
                <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 13, color: isOverdue ? '#EF4444' : isDueSoon ? '#F59E0B' : '#6B7280', fontWeight: isOverdue || isDueSoon ? 600 : 400 }}>
                  <Icons.Calendar />{formatDate(task.dueDate)}{isOverdue && 'ï¼ˆå·²é€¾æœŸï¼‰'}{isDueSoon && !isOverdue && 'ï¼ˆå³å°†åˆ°æœŸï¼‰'}
                </span>
                <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 13, color: '#6B7280' }}><Icons.User />{task.owner.name}</span>
                {task.collaborators.length > 0 && <span style={{ display: 'flex', alignItems: 'center', gap: 4, fontSize: 13, color: '#6B7280' }}><Icons.Users />+{task.collaborators.length}</span>}
              </div>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
              <StatusBadge status={task.status} />
              <ProgressRing progress={task.progress} />
              <div style={{ width: 36, height: 36, borderRadius: 8, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#9CA3AF', cursor: 'pointer' }}><Icons.MoreHorizontal /></div>
            </div>
          </div>
        </div>
      );
    };

    // ==================== ä¾§è¾¹æ  ====================
    const Sidebar = ({ activeMenu, onMenuChange, collapsed, onToggle }) => {
      const items = [
        { id: 'dashboard', Icon: Icons.Home, label: 'å·¥ä½œå°' },
        { id: 'tasks', Icon: Icons.ClipboardList, label: 'ä»»åŠ¡ä¸­å¿ƒ', badge: 12 },
        { id: 'notifications', Icon: Icons.Bell, label: 'æ¶ˆæ¯é€šçŸ¥', badge: 3 },
      ];
      
      const NavItem = ({ item, active }) => (
        <div onClick={() => onMenuChange(item.id)}
          style={{ display: 'flex', alignItems: 'center', gap: 12, margin: '4px 12px', padding: collapsed ? 12 : '12px 16px', borderRadius: 12, cursor: 'pointer', background: active ? '#EEF2FF' : 'transparent', color: active ? '#4F46E5' : '#6B7280', fontWeight: active ? 600 : 500, fontSize: 14, position: 'relative', justifyContent: collapsed ? 'center' : 'flex-start', transition: 'all 0.15s' }}
          onMouseEnter={e => { if (!active) e.currentTarget.style.background = '#F3F4F6'; }}
          onMouseLeave={e => { if (!active) e.currentTarget.style.background = 'transparent'; }}>
          {active && <div style={{ position: 'absolute', left: 0, top: '50%', transform: 'translateY(-50%)', width: 3, height: 20, background: '#6366F1', borderRadius: '0 2px 2px 0' }} />}
          <item.Icon />
          {!collapsed && <span style={{ flex: 1 }}>{item.label}</span>}
          {!collapsed && item.badge && <span style={{ minWidth: 20, height: 20, padding: '0 6px', background: '#EF4444', color: 'white', fontSize: 11, fontWeight: 600, borderRadius: 10, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>{item.badge}</span>}
        </div>
      );

      return (
        <aside style={{ width: collapsed ? 72 : 240, height: '100vh', background: 'linear-gradient(180deg, #FFFFFF 0%, #FAFBFC 100%)', borderRight: '1px solid #E5E7EB', position: 'fixed', left: 0, top: 0, zIndex: 100, display: 'flex', flexDirection: 'column', transition: 'width 0.2s' }}>
          <div style={{ height: 64, padding: '0 20px', display: 'flex', alignItems: 'center', gap: 12, borderBottom: '1px solid #F3F4F6', justifyContent: collapsed ? 'center' : 'flex-start' }}>
            <div style={{ width: 36, height: 36, borderRadius: 10, background: 'linear-gradient(135deg, #6366F1, #4F46E5)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', flexShrink: 0 }}><Icons.Target /></div>
            {!collapsed && <span style={{ fontSize: 20, fontWeight: 700, background: 'linear-gradient(135deg, #4F46E5, #818CF8)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>TaskLoop</span>}
          </div>
          <nav style={{ flex: 1, paddingTop: 12 }}>
            {items.map(item => <NavItem key={item.id} item={item} active={activeMenu === item.id} />)}
            <div style={{ height: 1, margin: '16px 20px', background: 'linear-gradient(90deg, transparent, #E5E7EB 20%, #E5E7EB 80%, transparent)' }} />
            <NavItem item={{ id: 'settings', Icon: Icons.Settings, label: 'ç³»ç»Ÿè®¾ç½®' }} active={activeMenu === 'settings'} />
          </nav>
          {!collapsed && (
            <div style={{ padding: '16px 20px', borderTop: '1px solid #F3F4F6', display: 'flex', alignItems: 'center', gap: 12 }}>
              <Avatar name={mockUser.name} size={36} />
              <div style={{ flex: 1, minWidth: 0 }}>
                <div style={{ fontSize: 14, fontWeight: 600, color: '#1F2937' }}>{mockUser.name}</div>
                <div style={{ fontSize: 12, color: '#6B7280' }}>{mockUser.department}</div>
              </div>
              <Icons.LogOut />
            </div>
          )}
          <button onClick={onToggle} style={{ position: 'absolute', right: -12, top: '50%', transform: 'translateY(-50%)', width: 24, height: 24, borderRadius: 12, background: 'white', border: '1px solid #E5E7EB', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#9CA3AF', boxShadow: '0 2px 4px rgba(0,0,0,0.05)', cursor: 'pointer' }}>
            {collapsed ? <Icons.ChevronRight /> : <Icons.ChevronLeft />}
          </button>
        </aside>
      );
    };

    // ==================== é¡µé¢ç»„ä»¶ ====================
    const DashboardPage = ({ onNavigate }) => {
      const stats = {
        pending: mockTasks.filter(t => t.status === 'NOT_STARTED').length,
        inProgress: mockTasks.filter(t => t.status === 'IN_PROGRESS').length,
        dueSoon: mockTasks.filter(t => getDaysUntilDue(t.dueDate) >= 0 && getDaysUntilDue(t.dueDate) <= 3 && t.status !== 'COMPLETED').length,
        overdue: mockTasks.filter(t => getDaysUntilDue(t.dueDate) < 0 && t.status !== 'COMPLETED').length,
      };
      const urgentTasks = mockTasks.filter(t => t.status !== 'COMPLETED' && (getDaysUntilDue(t.dueDate) < 0 || t.priority === 'P1')).slice(0, 3);

      return (
        <div className="animate-fadeIn">
          <div style={{ marginBottom: 32 }}>
            <h1 style={{ fontSize: 28, fontWeight: 700, color: '#111827', marginBottom: 8 }}>æ—©ä¸Šå¥½ï¼Œ{mockUser.name} ğŸ‘‹</h1>
            <p style={{ fontSize: 15, color: '#6B7280' }}>ä»Šå¤©æœ‰ {stats.pending + stats.inProgress} é¡¹ä»»åŠ¡ç­‰å¾…å¤„ç†ï¼ŒåŠ æ²¹ï¼</p>
          </div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: 20, marginBottom: 32 }}>
            <StatCard title="å¾…åŠä»»åŠ¡" value={stats.pending} Icon={Icons.Circle} color="primary" onClick={() => onNavigate('tasks', 'NOT_STARTED')} />
            <StatCard title="è¿›è¡Œä¸­" value={stats.inProgress} change="+2" trend="up" Icon={Icons.RefreshCw} color="primary" onClick={() => onNavigate('tasks', 'IN_PROGRESS')} />
            <StatCard title="æœ¬å‘¨åˆ°æœŸ" value={stats.dueSoon} Icon={Icons.Clock} color="warning" />
            <StatCard title="å·²é€¾æœŸ" value={stats.overdue} Icon={Icons.AlertTriangle} color="danger" onClick={() => onNavigate('tasks', 'overdue')} />
          </div>
          {urgentTasks.length > 0 && (
            <div style={{ background: 'linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%)', borderRadius: 20, padding: 24, marginBottom: 32 }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16, color: '#111827' }}><Icons.Sparkles /><h2 style={{ fontSize: 16, fontWeight: 600 }}>éœ€è¦ç«‹å³å¤„ç†</h2></div>
              <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
                {urgentTasks.map(task => (
                  <div key={task.id} onClick={() => onNavigate('tasks')} style={{ background: 'rgba(255,255,255,0.8)', backdropFilter: 'blur(10px)', borderRadius: 12, padding: '12px 16px', display: 'flex', alignItems: 'center', gap: 12, cursor: 'pointer' }}>
                    <div style={{ width: 8, height: 8, borderRadius: 4, background: priorityColors[task.priority].dot }} />
                    <span style={{ flex: 1, fontSize: 14, fontWeight: 500, color: '#1F2937' }}>{task.title}</span>
                    <span style={{ fontSize: 13, color: '#4B5563' }}>{getDaysUntilDue(task.dueDate) < 0 ? `é€¾æœŸ${Math.abs(getDaysUntilDue(task.dueDate))}å¤©` : `${getDaysUntilDue(task.dueDate)}å¤©ååˆ°æœŸ`}</span>
                    <Icons.ArrowUpRight />
                  </div>
                ))}
              </div>
            </div>
          )}
          <div>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 }}>
              <h2 style={{ fontSize: 18, fontWeight: 600, color: '#111827' }}>æœ€è¿‘ä»»åŠ¡</h2>
              <Button variant="ghost" size="sm" onClick={() => onNavigate('tasks')}>æŸ¥çœ‹å…¨éƒ¨ <Icons.ArrowUpRight /></Button>
            </div>
            <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
              {mockTasks.slice(0, 4).map(task => <TaskCard key={task.id} task={task} onClick={() => {}} />)}
            </div>
          </div>
        </div>
      );
    };

    const TasksPage = ({ initialFilter }) => {
      const [statusFilter, setStatusFilter] = useState(initialFilter || 'all');
      const [searchQuery, setSearchQuery] = useState('');
      const [showCreate, setShowCreate] = useState(false);
      const [selectedTask, setSelectedTask] = useState(null);

      const filteredTasks = mockTasks.filter(task => {
        if (statusFilter !== 'all') {
          if (statusFilter === 'overdue') return getDaysUntilDue(task.dueDate) < 0 && task.status !== 'COMPLETED';
          if (task.status !== statusFilter) return false;
        }
        if (searchQuery && !task.title.toLowerCase().includes(searchQuery.toLowerCase())) return false;
        return true;
      });

      const tabs = [
        { id: 'all', label: 'å…¨éƒ¨' },
        { id: 'NOT_STARTED', label: 'å¾…å¼€å§‹', count: mockTasks.filter(t => t.status === 'NOT_STARTED').length },
        { id: 'IN_PROGRESS', label: 'è¿›è¡Œä¸­', count: mockTasks.filter(t => t.status === 'IN_PROGRESS').length },
        { id: 'PENDING_REVIEW', label: 'å¾…éªŒæ”¶', count: mockTasks.filter(t => t.status === 'PENDING_REVIEW').length },
        { id: 'overdue', label: 'å·²é€¾æœŸ', count: mockTasks.filter(t => getDaysUntilDue(t.dueDate) < 0 && t.status !== 'COMPLETED').length },
        { id: 'COMPLETED', label: 'å·²å®Œæˆ' },
      ];

      return (
        <div className="animate-fadeIn">
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 24 }}>
            <div>
              <h1 style={{ fontSize: 24, fontWeight: 700, color: '#111827', marginBottom: 4 }}>ä»»åŠ¡ä¸­å¿ƒ</h1>
              <p style={{ fontSize: 14, color: '#6B7280' }}>ç®¡ç†å’Œè·Ÿè¸ªæ‰€æœ‰ä»»åŠ¡çš„è¿›åº¦</p>
            </div>
            <Button icon={<Icons.Plus />} onClick={() => setShowCreate(true)}>åˆ›å»ºä»»åŠ¡</Button>
          </div>
          <div style={{ marginBottom: 24 }}>
            <div style={{ display: 'flex', gap: 4, padding: 4, background: '#F3F4F6', borderRadius: 12, width: 'fit-content', marginBottom: 16 }}>
              {tabs.map(tab => (
                <button key={tab.id} onClick={() => setStatusFilter(tab.id)}
                  style={{ padding: '8px 16px', background: statusFilter === tab.id ? 'white' : 'transparent', border: 'none', borderRadius: 8, fontSize: 14, fontWeight: 500, color: statusFilter === tab.id ? '#111827' : '#6B7280', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 6, boxShadow: statusFilter === tab.id ? '0 1px 3px rgba(0,0,0,0.1)' : 'none', transition: 'all 0.15s' }}>
                  {tab.label}
                  {tab.count > 0 && <span style={{ minWidth: 18, height: 18, padding: '0 5px', background: statusFilter === tab.id ? '#E0E7FF' : '#E5E7EB', color: statusFilter === tab.id ? '#4F46E5' : '#6B7280', fontSize: 11, fontWeight: 600, borderRadius: 9, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>{tab.count}</span>}
                </button>
              ))}
            </div>
            <div style={{ display: 'flex', gap: 12, alignItems: 'center' }}>
              <Input placeholder="æœç´¢ä»»åŠ¡..." icon={<Icons.Search />} value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} style={{ width: 280 }} />
              <Button variant="ghost" icon={<Icons.Filter />}>æ›´å¤šç­›é€‰</Button>
            </div>
          </div>
          <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>
            {filteredTasks.length === 0 ? (
              <div style={{ padding: 60, textAlign: 'center', background: 'white', borderRadius: 16, border: '1px solid #E5E7EB' }}>
                <div style={{ color: '#D1D5DB', marginBottom: 16 }}><Icons.ClipboardList /></div>
                <p style={{ fontSize: 15, color: '#6B7280' }}>æš‚æ— ç¬¦åˆæ¡ä»¶çš„ä»»åŠ¡</p>
              </div>
            ) : filteredTasks.map(task => <TaskCard key={task.id} task={task} onClick={() => setSelectedTask(task)} />)}
          </div>
          {showCreate && <CreateModal onClose={() => setShowCreate(false)} />}
          {selectedTask && <DetailDrawer task={selectedTask} onClose={() => setSelectedTask(null)} />}
        </div>
      );
    };

    const NotificationsPage = () => {
      const [notifications, setNotifications] = useState(mockNotifications);
      const getIcon = (type) => {
        if (type === 'TASK_ASSIGNED') return { Icon: Icons.ClipboardList, bg: '#DBEAFE', color: '#3B82F6' };
        if (type === 'TASK_DUE_SOON') return { Icon: Icons.Clock, bg: '#FEF3C7', color: '#F59E0B' };
        if (type === 'TASK_OVERDUE') return { Icon: Icons.AlertTriangle, bg: '#FEE2E2', color: '#EF4444' };
        return { Icon: Icons.Bell, bg: '#F3F4F6', color: '#6B7280' };
      };

      return (
        <div style={{ maxWidth: 640, margin: '0 auto' }} className="animate-fadeIn">
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 24 }}>
            <h1 style={{ fontSize: 24, fontWeight: 700, color: '#111827' }}>æ¶ˆæ¯é€šçŸ¥</h1>
            <Button variant="ghost" size="sm" onClick={() => setNotifications(n => n.map(x => ({ ...x, read: true })))}>å…¨éƒ¨å·²è¯»</Button>
          </div>
          <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>
            {notifications.map(n => {
              const { Icon, bg, color } = getIcon(n.type);
              return (
                <div key={n.id} onClick={() => setNotifications(prev => prev.map(x => x.id === n.id ? { ...x, read: true } : x))}
                  style={{ display: 'flex', gap: 16, padding: 16, background: n.read ? 'white' : '#EEF2FF', borderRadius: 16, cursor: 'pointer', transition: 'background 0.15s', position: 'relative' }}>
                  <div style={{ width: 40, height: 40, borderRadius: 10, background: bg, color: color, display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}><Icon /></div>
                  <div style={{ flex: 1, minWidth: 0 }}>
                    <div style={{ fontSize: 14, fontWeight: 600, color: '#111827', marginBottom: 4 }}>{n.title}</div>
                    <div style={{ fontSize: 14, color: '#4B5563', marginBottom: 8 }}>{n.content}</div>
                    <div style={{ fontSize: 12, color: '#9CA3AF' }}>{n.time}</div>
                  </div>
                  {!n.read && <div style={{ position: 'absolute', top: '50%', right: 16, transform: 'translateY(-50%)', width: 8, height: 8, borderRadius: 4, background: '#6366F1' }} />}
                </div>
              );
            })}
          </div>
        </div>
      );
    };

    // ==================== æ¨¡æ€æ¡† ====================
    const CreateModal = ({ onClose }) => {
      const [form, setForm] = useState({ title: '', priority: 'P2', owner: '', dueDate: '', criteria: '' });
      
      return (
        <>
          <div onClick={onClose} style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.5)', backdropFilter: 'blur(4px)', zIndex: 1000 }} />
          <div style={{ position: 'fixed', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', width: 560, maxHeight: '90vh', background: 'white', borderRadius: 20, boxShadow: '0 25px 50px rgba(0,0,0,0.25)', zIndex: 1001, overflow: 'hidden' }} className="animate-fadeIn">
            <div style={{ padding: '24px 24px 20px', borderBottom: '1px solid #F3F4F6' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                <div>
                  <h2 style={{ fontSize: 20, fontWeight: 700, color: '#111827', marginBottom: 4 }}>åˆ›å»ºæ–°ä»»åŠ¡</h2>
                  <p style={{ fontSize: 14, color: '#6B7280' }}>å¡«å†™ä»»åŠ¡ä¿¡æ¯ï¼ŒæŒ‡å®šè´Ÿè´£äººå’Œæˆªæ­¢æ—¥æœŸ</p>
                </div>
                <button onClick={onClose} style={{ width: 32, height: 32, borderRadius: 8, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#9CA3AF', cursor: 'pointer', border: 'none', background: 'transparent' }}><Icons.X /></button>
              </div>
            </div>
            <div style={{ padding: 24, maxHeight: 'calc(90vh - 180px)', overflow: 'auto' }}>
              <div style={{ display: 'flex', flexDirection: 'column', gap: 20 }}>
                <div>
                  <label style={{ display: 'block', fontSize: 14, fontWeight: 500, color: '#374151', marginBottom: 8 }}>ä»»åŠ¡æ ‡é¢˜ <span style={{ color: '#EF4444' }}>*</span></label>
                  <input placeholder="è¾“å…¥ä»»åŠ¡æ ‡é¢˜..." value={form.title} onChange={e => setForm({ ...form, title: e.target.value })} style={{ width: '100%', height: 48, padding: '0 16px', border: '1px solid #D1D5DB', borderRadius: 12, fontSize: 16, outline: 'none' }} />
                </div>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}>
                  <div>
                    <label style={{ display: 'block', fontSize: 14, fontWeight: 500, color: '#374151', marginBottom: 8 }}>è´Ÿè´£äºº <span style={{ color: '#EF4444' }}>*</span></label>
                    <select value={form.owner} onChange={e => setForm({ ...form, owner: e.target.value })} style={{ width: '100%', height: 42, padding: '0 14px', border: '1px solid #D1D5DB', borderRadius: 12, fontSize: 14, background: 'white', outline: 'none' }}>
                      <option value="">é€‰æ‹©è´Ÿè´£äºº</option>
                      <option value="1">å¼ ä¸‰</option>
                      <option value="2">æå››</option>
                      <option value="3">ç‹äº”</option>
                    </select>
                  </div>
                  <div>
                    <label style={{ display: 'block', fontSize: 14, fontWeight: 500, color: '#374151', marginBottom: 8 }}>ä¼˜å…ˆçº§ <span style={{ color: '#EF4444' }}>*</span></label>
                    <select value={form.priority} onChange={e => setForm({ ...form, priority: e.target.value })} style={{ width: '100%', height: 42, padding: '0 14px', border: '1px solid #D1D5DB', borderRadius: 12, fontSize: 14, background: 'white', outline: 'none' }}>
                      <option value="P1">P1 - ç´§æ€¥</option>
                      <option value="P2">P2 - é‡è¦</option>
                      <option value="P3">P3 - æ™®é€š</option>
                    </select>
                  </div>
                </div>
                <div>
                  <label style={{ display: 'block', fontSize: 14, fontWeight: 500, color: '#374151', marginBottom: 8 }}>æˆªæ­¢æ—¥æœŸ <span style={{ color: '#EF4444' }}>*</span></label>
                  <input type="date" value={form.dueDate} onChange={e => setForm({ ...form, dueDate: e.target.value })} style={{ width: '100%', height: 42, padding: '0 14px', border: '1px solid #D1D5DB', borderRadius: 12, fontSize: 14, outline: 'none' }} />
                </div>
                <div>
                  <label style={{ display: 'block', fontSize: 14, fontWeight: 500, color: '#374151', marginBottom: 8 }}>éªŒæ”¶æ ‡å‡† <span style={{ color: '#EF4444' }}>*</span></label>
                  <div style={{ fontSize: 12, color: '#6B7280', marginBottom: 8, display: 'flex', alignItems: 'center', gap: 4 }}><Icons.Sparkles />æ¸…æ™°çš„éªŒæ”¶æ ‡å‡†æœ‰åŠ©äºä»»åŠ¡é¡ºåˆ©éªŒæ”¶</div>
                  <textarea placeholder="æè¿°ä»»åŠ¡å®Œæˆçš„åˆ¤æ–­æ ‡å‡†..." rows={3} value={form.criteria} onChange={e => setForm({ ...form, criteria: e.target.value })} style={{ width: '100%', padding: 14, border: '1px solid #D1D5DB', borderRadius: 12, fontSize: 14, resize: 'none', outline: 'none' }} />
                </div>
              </div>
            </div>
            <div style={{ padding: '16px 24px', borderTop: '1px solid #F3F4F6', background: '#F9FAFB', display: 'flex', justifyContent: 'flex-end', gap: 12 }}>
              <Button variant="secondary" onClick={onClose}>å–æ¶ˆ</Button>
              <Button>åˆ›å»ºä»»åŠ¡</Button>
            </div>
          </div>
        </>
      );
    };

    const DetailDrawer = ({ task, onClose }) => {
      const [tab, setTab] = useState('details');
      const tabs = [{ id: 'details', label: 'è¯¦æƒ…' }, { id: 'progress', label: 'è¿›åº¦æ›´æ–°' }, { id: 'evidence', label: 'è¯æ®é™„ä»¶' }];

      return (
        <>
          <div onClick={onClose} style={{ position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.3)', zIndex: 1000 }} />
          <div style={{ position: 'fixed', right: 0, top: 0, bottom: 0, width: 560, background: 'white', boxShadow: '-20px 0 60px rgba(0,0,0,0.1)', zIndex: 1001, display: 'flex', flexDirection: 'column' }} className="animate-slideIn">
            <div style={{ padding: 24, borderBottom: '1px solid #E5E7EB' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 16 }}>
                <PriorityTag priority={task.priority} />
                <StatusBadge status={task.status} />
                <button onClick={onClose} style={{ marginLeft: 'auto', width: 32, height: 32, borderRadius: 8, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#9CA3AF', cursor: 'pointer', border: 'none', background: 'transparent' }}><Icons.X /></button>
              </div>
              <h2 style={{ fontSize: 22, fontWeight: 700, color: '#111827', marginBottom: 16 }}>{task.title}</h2>
              <div style={{ display: 'flex', gap: 24 }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                  <Avatar name={task.owner.name} size={32} />
                  <div><div style={{ fontSize: 12, color: '#6B7280' }}>è´Ÿè´£äºº</div><div style={{ fontSize: 14, fontWeight: 500, color: '#111827' }}>{task.owner.name}</div></div>
                </div>
                <div style={{ width: 1, background: '#E5E7EB' }} />
                <div><div style={{ fontSize: 12, color: '#6B7280' }}>æˆªæ­¢æ—¥æœŸ</div><div style={{ fontSize: 14, fontWeight: 500, color: '#111827' }}>{task.dueDate}</div></div>
                <div style={{ width: 1, background: '#E5E7EB' }} />
                <div><div style={{ fontSize: 12, color: '#6B7280' }}>è¿›åº¦</div><ProgressRing progress={task.progress} size={32} /></div>
              </div>
            </div>
            <div style={{ display: 'flex', gap: 4, padding: '12px 24px', borderBottom: '1px solid #E5E7EB' }}>
              {tabs.map(t => (
                <button key={t.id} onClick={() => setTab(t.id)} style={{ padding: '8px 16px', background: tab === t.id ? '#EEF2FF' : 'transparent', border: 'none', borderRadius: 8, fontSize: 14, fontWeight: tab === t.id ? 600 : 500, color: tab === t.id ? '#4F46E5' : '#6B7280', cursor: 'pointer', transition: 'all 0.15s' }}>{t.label}</button>
              ))}
            </div>
            <div style={{ flex: 1, padding: 24, overflow: 'auto' }}>
              {tab === 'details' && (
                <div>
                  <h3 style={{ fontSize: 14, fontWeight: 600, color: '#111827', marginBottom: 12 }}>éªŒæ”¶æ ‡å‡†</h3>
                  <div style={{ padding: 16, background: '#F9FAFB', borderRadius: 12, fontSize: 14, color: '#374151', whiteSpace: 'pre-wrap', lineHeight: 1.7 }}>{task.acceptanceCriteria}</div>
                  {task.collaborators.length > 0 && (
                    <div style={{ marginTop: 24 }}>
                      <h3 style={{ fontSize: 14, fontWeight: 600, color: '#111827', marginBottom: 12 }}>åä½œäºº</h3>
                      <div style={{ display: 'flex', gap: 8 }}>{task.collaborators.map((c, i) => <div key={i} style={{ display: 'flex', alignItems: 'center', gap: 8 }}><Avatar name={c.name} size={32} /><span style={{ fontSize: 14, color: '#374151' }}>{c.name}</span></div>)}</div>
                    </div>
                  )}
                </div>
              )}
              {tab === 'progress' && (
                task.updates.length === 0 ? (
                  <div style={{ textAlign: 'center', padding: 40, color: '#9CA3AF' }}><Icons.RefreshCw /><p style={{ marginTop: 12 }}>æš‚æ— è¿›åº¦æ›´æ–°</p></div>
                ) : (
                  <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>
                    {task.updates.map((u, i) => (
                      <div key={i} style={{ display: 'flex', gap: 12, padding: 16, background: '#F9FAFB', borderRadius: 12 }}>
                        <div style={{ width: 8, height: 8, borderRadius: 4, background: '#6366F1', marginTop: 6 }} />
                        <div style={{ flex: 1 }}>
                          <div style={{ fontSize: 14, color: '#1F2937', marginBottom: 4 }}>{u.content}</div>
                          <div style={{ fontSize: 12, color: '#6B7280' }}>{u.date} Â· è¿›åº¦: {u.progress}%</div>
                        </div>
                      </div>
                    ))}
                  </div>
                )
              )}
              {tab === 'evidence' && <div style={{ textAlign: 'center', padding: 40, color: '#9CA3AF' }}><Icons.ClipboardList /><p style={{ marginTop: 12 }}>æš‚æ— è¯æ®é™„ä»¶</p><Button variant="secondary" size="sm" style={{ marginTop: 16 }}>ä¸Šä¼ é™„ä»¶</Button></div>}
            </div>
            <div style={{ padding: '16px 24px', borderTop: '1px solid #E5E7EB', background: '#F9FAFB', display: 'flex', gap: 12 }}>
              <Button variant="secondary" icon={<Icons.Edit3 />} fullWidth>ç¼–è¾‘ä»»åŠ¡</Button>
              <Button icon={<Icons.RefreshCw />} fullWidth>æ›´æ–°è¿›åº¦</Button>
            </div>
          </div>
        </>
      );
    };

    // ==================== ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆª ====================
    const MobileNav = ({ active, onChange, onCreate }) => {
      const items = [
        { id: 'dashboard', Icon: Icons.Home, label: 'å·¥ä½œå°' },
        { id: 'tasks', Icon: Icons.ClipboardList, label: 'ä»»åŠ¡', badge: 5 },
        { id: 'create', Icon: Icons.Plus, label: 'åˆ›å»º' },
        { id: 'notifications', Icon: Icons.Bell, label: 'é€šçŸ¥', badge: 3 },
        { id: 'profile', Icon: Icons.User, label: 'æˆ‘çš„' },
      ];

      return (
        <nav style={{ position: 'fixed', bottom: 0, left: 0, right: 0, height: 60, background: 'rgba(255,255,255,0.95)', backdropFilter: 'blur(20px)', borderTop: '1px solid #E5E7EB', display: 'flex', alignItems: 'center', justifyContent: 'space-around', zIndex: 100 }}>
          {items.map(item => item.id === 'create' ? (
            <div key={item.id} style={{ position: 'relative', top: -16 }}>
              <button onClick={onCreate} style={{ width: 56, height: 56, borderRadius: 28, background: 'linear-gradient(135deg, #6366F1, #4F46E5)', border: 'none', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', boxShadow: '0 4px 16px rgba(99, 102, 241, 0.4)', cursor: 'pointer' }}>
                <Icons.Plus />
              </button>
            </div>
          ) : (
            <button key={item.id} onClick={() => onChange(item.id)} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', width: 64, height: 48, background: 'transparent', border: 'none', color: active === item.id ? '#6366F1' : '#9CA3AF', cursor: 'pointer', position: 'relative' }}>
              <item.Icon />
              <span style={{ fontSize: 10, fontWeight: 500, marginTop: 2 }}>{item.label}</span>
              {item.badge && <span style={{ position: 'absolute', top: 2, right: 12, minWidth: 16, height: 16, padding: '0 4px', background: '#EF4444', color: 'white', fontSize: 10, fontWeight: 600, borderRadius: 8, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>{item.badge}</span>}
            </button>
          ))}
        </nav>
      );
    };

    // ==================== ä¸»åº”ç”¨ ====================
    function App() {
      const [menu, setMenu] = useState('dashboard');
      const [collapsed, setCollapsed] = useState(false);
      const [filter, setFilter] = useState(null);
      const [mobile, setMobile] = useState(false);
      const [showCreate, setShowCreate] = useState(false);

      useEffect(() => {
        const check = () => setMobile(window.innerWidth < 768);
        check();
        window.addEventListener('resize', check);
        return () => window.removeEventListener('resize', check);
      }, []);

      const navigate = (m, f = null) => { setMenu(m); setFilter(f); };

      const renderPage = () => {
        switch (menu) {
          case 'dashboard': return <DashboardPage onNavigate={navigate} />;
          case 'tasks': return <TasksPage initialFilter={filter} />;
          case 'notifications': return <NotificationsPage />;
          default: return <DashboardPage onNavigate={navigate} />;
        }
      };

      if (mobile) {
        return (
          <div style={{ minHeight: '100vh', background: '#F9FAFB' }}>
            <header style={{ position: 'sticky', top: 0, height: 56, padding: '0 16px', background: 'rgba(255,255,255,0.95)', backdropFilter: 'blur(20px)', borderBottom: '1px solid #E5E7EB', display: 'flex', alignItems: 'center', justifyContent: 'space-between', zIndex: 50 }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                <div style={{ width: 32, height: 32, borderRadius: 8, background: 'linear-gradient(135deg, #6366F1, #4F46E5)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white' }}><Icons.Target /></div>
                <span style={{ fontSize: 18, fontWeight: 700, color: '#111827' }}>TaskLoop</span>
              </div>
              <Avatar name={mockUser.name} size={32} />
            </header>
            <main style={{ padding: 16, paddingBottom: 80 }}>{renderPage()}</main>
            <MobileNav active={menu} onChange={setMenu} onCreate={() => setShowCreate(true)} />
            {showCreate && <CreateModal onClose={() => setShowCreate(false)} />}
          </div>
        );
      }

      return (
        <div style={{ minHeight: '100vh', background: '#F9FAFB' }}>
          <Sidebar activeMenu={menu} onMenuChange={setMenu} collapsed={collapsed} onToggle={() => setCollapsed(!collapsed)} />
          <main style={{ marginLeft: collapsed ? 72 : 240, minHeight: '100vh', transition: 'margin-left 0.2s' }}>
            <header style={{ position: 'sticky', top: 0, height: 64, padding: '0 32px', background: 'rgba(255,255,255,0.8)', backdropFilter: 'blur(20px)', borderBottom: '1px solid #E5E7EB', display: 'flex', alignItems: 'center', justifyContent: 'space-between', zIndex: 50 }}>
              <Input placeholder="æœç´¢ä»»åŠ¡ã€é¡¹ç›®..." icon={<Icons.Search />} style={{ width: 320 }} />
              <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
                <button style={{ width: 40, height: 40, borderRadius: 10, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'transparent', border: 'none', color: '#6B7280', cursor: 'pointer', position: 'relative' }}>
                  <Icons.Bell />
                  <span style={{ position: 'absolute', top: 6, right: 6, width: 8, height: 8, borderRadius: 4, background: '#EF4444' }} />
                </button>
                <Avatar name={mockUser.name} />
              </div>
            </header>
            <div style={{ padding: 32 }}>{renderPage()}</div>
          </main>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
